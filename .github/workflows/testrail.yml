# This workflow will install Python dependencies, run tests and lint with a variety of Python versions
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions

name: Python package

on:
  repository_dispatch:
      types: [run-testrail-report]


jobs:
  build:

    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.7]


    env:
        PERSONAL_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        PUBLISH_BRANCH: gh-pages
        PUBLISH_DIR: allure-history
        TESTRAIL_REPORT_TYPE:  ${{ github.event.client_payload.kind }}
        
    steps:
      - uses: actions/checkout@v2
      - name: Setup python
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}
          architecture: x64
      - name: Install Python dependencies
        uses: py-actions/py-dependency-install@v2
      - run: 'echo TESTRAIL_REPORT_TYPE'
      - run: |
            echo "REPORT_URL=$(python testrail_utils.py $TESTRAIL_REPORT_TYPE)" >> $GITHUB_ENV
      - run: 'echo $REPORT_URL'
      - name: Slack Notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_CHANNEL: for_test
          SLACK_COLOR: good
          SLACK_ICON: https://pbs.twimg.com/profile_images/1083368648427876353/rDzk-i_U_400x400.jpg
          SLACK_MESSAGE: ${{ env.REPORT_URL }}
          SLACK_TITLE: TestRail report
          SLACK_USERNAME: testrail
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}

